@page "/steam"

<PageTitle>我的Steam游戏 - 个人文章分享</PageTitle>

@using System.Globalization

@if (_isLoading)
{
    <SteamListSkeleton />
}
else
{
    <div class="steam-container">
        <div class="steam-header">
            <h1 class="steam-header__title">
                <i class="fa fa-gamepad"></i> Steam 游戏库
            </h1>
        </div>

        <div class="steam-game-grid">
            @foreach (var item in _steamLibraries.OrderBy(x => x.Name, StringComparer.Create(new CultureInfo("zh-Hans"), false)))
            {
                var time = TimeSpan.FromMinutes(item.PlayTime);
                <div class="steam-game-card">
                    <a href="/steam/@item.Id"
                       class="steam-game-card__link">
                        <div class="steam-game-card__image-wrapper">
                            <img src="@item.ImageLogo" alt="@item.Name" class="steam-game-card__image lazy"
                                 data-src="@item.ImageLogo"/>
                        </div>
                        <div class="steam-game-card__content">
                            <h2 class="steam-game-card__title">@item.Name</h2>
                            <div class="steam-game-card__meta">
                                <i class="fa-regular fa-clock"></i>
                                <span>@($"{time.TotalHours:0} 小时 {time.Minutes:00} 分钟")</span>
                            </div>

                            <div class="steam-game-card__achievements">
                                @if (item.Achievements.Count > 0)
                                {
                                    var unlockCount = item.Achievements.Count(x => x.UnlockTime.HasValue);
                                    var count = item.Achievements.Count;
                                    var percent = count > 0 ? ((decimal)unlockCount / count * 100).ToString("F0") : "0";

                                    <div class="steam-summary">
                                        <div class="steam-summary__stats">
                                            <span>成就进度</span>
                                            <span>@percent%</span>
                                        </div>
                                        <div class="steam-summary__progress-track">
                                            <div class="steam-summary__progress-bar" style="width: 0"
                                                 data-width="@percent%"></div>
                                        </div>
                                        <div class="steam-summary__icons">
                                            @foreach (var achievement in item.Achievements.Where(x => x.UnlockTime.HasValue).OrderByDescending(x => x.UnlockTime).Take(10))
                                            {
                                                <div class="steam-summary__icon" title="@achievement.DisplayName">
                                                    <img src="@achievement.Icon" alt="@achievement.DisplayName"
                                                         loading="lazy"/>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="steam-summary">
                                        <div class="steam-summary__stats">
                                            <span>暂无成就</span>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </a>
                </div>
            }
        </div>

        @* @{ *@
        @*     var commentModel = (CommentNode.Steam, "Index"); *@
        @* } *@
        @* <div style="margin-top: var(--spacing-xl);"> *@
        @*     <partial name="_GlobalCommentPartial" model="commentModel"/> *@
        @* </div> *@
    </div>
}
