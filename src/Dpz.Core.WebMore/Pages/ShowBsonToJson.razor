@page "/bson-to-json"

<PageTitle>显示BSON 转 JSON - 个人文章分享</PageTitle>

<div class="bson-tool">
    <div class="bson-tool__header">
        <h1 class="bson-tool__title">BSON 转 JSON 工具</h1>
    </div>

    <div class="bson-tool__section">
        <div class="bson-tool__upload-area">
            <InputFile OnChange="OnSelectedFile" class="bson-tool__file-input" accept=".bson" />
            <div class="bson-tool__upload-content">
                <i class="fa-solid fa-cloud-arrow-up bson-tool__upload-icon"></i>
                <div class="bson-tool__upload-text">点击或拖拽 BSON 文件到此处</div>
                <div class="bson-tool__upload-hint">支持 .bson 格式文件</div>
            </div>
        </div>
        
        @if (_fileSize > 0)
        {
            <div class="bson-tool__file-info">
                <i class="fa-solid fa-file"></i>
                <span>File size: @_fileSize bytes</span>
            </div>
        }

        @if (!string.IsNullOrEmpty(_errorMessage))
        {
            <div class="bson-tool__error" style="margin-top: 1rem;">
                <i class="fa-solid fa-circle-exclamation"></i> @_errorMessage
            </div>
        }
    </div>

    <div class="bson-tool__section">
        <div class="bson-tool__input-group">
            <label class="bson-tool__label">查看 ObjectId 创建时间</label>
            <input type="text" 
                   @bind="_objectIdValue" 
                   @bind:event="oninput"
                   @bind:after="OnObjectIdValueChange"
                   class="bson-tool__input" 
                   placeholder="输入 ObjectId..." />
        </div>

        @if (_parseObjectIdSuccess.HasValue)
        {
            @if (_parseObjectIdSuccess == true && _objectId != null)
            {
                <div class="bson-tool__result-card">
                    <div class="bson-tool__result-row">
                        <span class="bson-tool__result-label">UTC Time</span>
                        <span class="bson-tool__result-value">@_objectId.Value.CreationTime.ToUniversalTime().ToString("yyyy/MM/dd HH:mm:ss")</span>
                    </div>
                    <div class="bson-tool__result-row">
                        <span class="bson-tool__result-label">Local Time</span>
                        <span class="bson-tool__result-value">@_objectId.Value.CreationTime.ToLocalTime().ToString("yyyy/MM/dd HH:mm:ss")</span>
                    </div>
                    <div class="bson-tool__result-row">
                        <span class="bson-tool__result-label">Timestamp</span>
                        <span class="bson-tool__result-value">@_objectId.Value.Timestamp.ToString("N")</span>
                    </div>
                </div>
            }
            else if (_parseObjectIdSuccess == false)
            {
                <div class="bson-tool__error">
                    <i class="fa-solid fa-triangle-exclamation"></i> ObjectId 无效
                </div>
            }
        }
    </div>

    <div class="bson-tool__code-container">
        @* 使用 @key 强制 Blazor 在内容更新时重新创建 DOM 元素，防止 Prism.js 修改 DOM 后导致的渲染冲突 *@
        <pre @key="@_renderKey"><code class="language-json">@_bsonValue</code></pre>
    </div>
</div>
