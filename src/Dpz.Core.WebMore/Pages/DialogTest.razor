@page "/test/dialog"
@using Dpz.Core.WebMore.Models
@using NotificationType = Dpz.Core.WebMore.Models.NotificationType
@inject IAppDialogService DialogService
@implements IDisposable

<PageTitle>å¯¹è¯æ¡†æµ‹è¯• - ä¸ªäººæ–‡ç« åˆ†äº«</PageTitle>

<div class="container mt-4">
    <h2 class="mb-4">Dialog Service å®Œæ•´æµ‹è¯•</h2>

    <div class="test-section">
        <h3>åŸºç¡€å¯¹è¯æ¡†æµ‹è¯•</h3>
        <div class="btn-group">
            <button class="btn btn-primary" @onclick="TestAlert">Alert æç¤ºæ¡†</button>
            <button class="btn btn-secondary" @onclick="TestConfirm">Confirm ç¡®è®¤æ¡†</button>
            <button class="btn btn-info" @onclick="TestPrompt">Prompt è¾“å…¥æ¡†</button>
            <button class="btn btn-success" @onclick="TestPromptWithDefault">Prompt (å¸¦é»˜è®¤å€¼)</button>
        </div>
        <div class="mt-2">ç»“æœ: <span id="last-result" class="result-value">@_lastResult</span></div>
    </div>

    <div class="test-section">
        <h3>è‡ªå®šä¹‰ç»„ä»¶å¯¹è¯æ¡†</h3>
        <div class="btn-group">
            <button class="btn btn-primary" @onclick="TestCustomComponent">ç®€å•è¡¨å•ç»„ä»¶</button>
            <button class="btn btn-success" @onclick="TestCustomComponentWithResult">å¸¦è¿”å›å€¼çš„ç»„ä»¶</button>
            <button class="btn btn-info" @onclick="TestComplexForm">å¤æ‚è¡¨å•</button>
            <button class="btn btn-warning" @onclick="TestCustomWidth">è‡ªå®šä¹‰å®½åº¦</button>
        </div>
        <div class="mt-2">
            @if (_componentResult != null)
            {
                <div class="result-card">
                    <strong>ç»„ä»¶è¿”å›ç»“æœ:</strong>
                    <pre>@_componentResult</pre>
                </div>
            }
        </div>
    </div>

    <div class="test-section">
        <h3>Toast æ¶ˆæ¯æç¤º</h3>
        <div class="btn-group">
            <button class="btn btn-info" @onclick="@(() => DialogService.Toast("è¿™æ˜¯ä¸€æ¡æ™®é€šæ¶ˆæ¯"))">Info</button>
            <button class="btn btn-success" @onclick="@(() => DialogService.Toast("æ“ä½œæˆåŠŸï¼", ToastType.Success))">Success</button>
            <button class="btn btn-warning" @onclick="@(() => DialogService.Toast("è¯·æ³¨æ„...", ToastType.Warning))">Warning</button>
            <button class="btn btn-danger" @onclick="@(() => DialogService.Toast("å‘ç”Ÿé”™è¯¯ï¼", ToastType.Error))">Error</button>
            <button class="btn btn-secondary" @onclick="MultipleToasts">æ‰¹é‡æ˜¾ç¤º</button>
            <button class="btn btn-primary" @onclick="TestToastDuration">è‡ªå®šä¹‰æ—¶é•¿</button>
        </div>
    </div>

    <div class="test-section">
        <h3>Notification é€šçŸ¥</h3>
        <div class="btn-group">
            <button class="btn btn-info" @onclick="TestBasicNotification">åŸºç¡€é€šçŸ¥</button>
            <button class="btn btn-success" @onclick="TestPersistentNotification">æŒä¹…é€šçŸ¥</button>
            <button class="btn btn-warning" @onclick="TestProgressNotification">è¿›åº¦æ¡é€šçŸ¥</button>
            <button class="btn btn-primary" @onclick="TestMultiProgressNotification">å¤šè¿›åº¦æ¡</button>
            <button class="btn btn-secondary" @onclick="TestRichNotification">å¯Œæ–‡æœ¬å†…å®¹</button>
            <button class="btn btn-danger" @onclick="@(() => DialogService.CloseAllNotifications())">å…³é—­å…¨éƒ¨</button>
        </div>
    </div>

    <div class="test-section">
        <h3>å®é™…åœºæ™¯æ¨¡æ‹Ÿ</h3>
        <div class="btn-group">
            <button class="btn btn-danger" @onclick="DeleteWorkflow">åˆ é™¤å·¥ä½œæµ</button>
            <button class="btn btn-primary" @onclick="ComplexProcess">å¤æ‚æµç¨‹</button>
            <button class="btn btn-info" @onclick="SimulateDownload">æ¨¡æ‹Ÿä¸‹è½½</button>
            <button class="btn btn-success" @onclick="SimulateMultiTask">å¤šä»»åŠ¡å¤„ç†</button>
            <button class="btn btn-warning" @onclick="UserRegistration">ç”¨æˆ·æ³¨å†Œ</button>
        </div>
    </div>

    <div class="test-section">
        <h3>è¾¹ç•Œæµ‹è¯•</h3>
        <div class="btn-group">
            <button class="btn btn-secondary" @onclick="TestLongMessage">è¶…é•¿æ¶ˆæ¯</button>
            <button class="btn btn-info" @onclick="TestEmptyInput">ç©ºè¾“å…¥å¤„ç†</button>
            <button class="btn btn-warning" @onclick="TestNestedDialogs">åµŒå¥—å¯¹è¯æ¡†</button>
            <button class="btn btn-danger" @onclick="TestRapidFire">å¿«é€Ÿè¿ç»­è§¦å‘</button>
            <button class="btn btn-primary" @onclick="TestSpecialCharacters">ç‰¹æ®Šå­—ç¬¦</button>
        </div>
    </div>

    <div class="test-section">
        <h3>é«˜çº§äº¤äº’æµ‹è¯•</h3>
        <div class="btn-group">
            <button class="btn btn-primary" @onclick="TestMaskToClose">ç‚¹å‡»é®ç½©å…³é—­</button>
            <button class="btn btn-warning" @onclick="TestNoEsc">ç¦ç”¨ Esc å…³é—­</button>
            <button class="btn btn-danger" @onclick="TestStrictDialog">ä¸¥æ ¼æ¨¡å¼(å¿…é¡»ç‚¹å‡»æŒ‰é’®)</button>
        </div>
    </div>
</div>

<style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .test-section {
        background: var(--color-bg-surface);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .test-section h3 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 1.25rem;
        border-bottom: 2px solid var(--color-border);
        padding-bottom: 10px;
        color: var(--color-text-main);
    }
    
    .btn-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        color: white;
        font-family: var(--font-stack-base);
    }
    
    .btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .btn-primary { background-color: #3b82f6; }
    .btn-secondary { background-color: #64748b; }
    .btn-success { background-color: #10b981; }
    .btn-danger { background-color: #ef4444; }
    .btn-warning { background-color: #f59e0b; }
    .btn-info { background-color: #06b6d4; }
    
    .mt-2 { margin-top: 0.5rem; }
    .mt-4 { margin-top: 1.5rem; }
    .mb-4 { margin-bottom: 1.5rem; }
    
    .result-value {
        color: var(--color-accent);
        font-weight: bold;
        font-family: var(--font-stack-mono);
    }
    
    .result-card {
        margin-top: 10px;
        padding: 15px;
        background: var(--color-bg-surface-alt);
        border: 1px solid var(--color-border);
        border-radius: 6px;
        font-family: var(--font-stack-mono);
        font-size: 0.9rem;
    }
    
    .result-card pre {
        margin: 10px 0 0 0;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    @@media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        .test-section {
            padding: 15px;
        }
        
        .btn-group {
            gap: 8px;
        }
        
        .btn {
            font-size: 13px;
            padding: 6px 12px;
        }
    }
</style>

@code {
    private string _lastResult = "-";
    private string? _componentResult;

    protected override void OnInitialized()
    {
        DialogService.OnDialogShow += HandleDialogShow;
    }

    public void Dispose()
    {
        DialogService.OnDialogShow -= HandleDialogShow;
    }

    private void HandleDialogShow(DialogModel model)
    {
        // é€šè¿‡æ‹¦æˆªäº‹ä»¶æ¥ä¿®æ”¹ç‰¹å®šæµ‹è¯•ç”¨ä¾‹çš„å¯¹è¯æ¡†å±æ€§
        // è¿™æ ·å°±ä¸éœ€è¦ä¿®æ”¹ IAppDialogService æ¥å£æ¥æ”¯æŒä¼ é€’è¿™äº›å‚æ•°
        switch (model.Title)
        {
            case "ç‚¹å‡»é®ç½©å…³é—­æµ‹è¯•":
                model.MaskToClose = true;
                model.EscToClose = true;
                break;
            case "ç¦ç”¨ Esc æµ‹è¯•":
                model.EscToClose = false;
                model.MaskToClose = false;
                break;
            case "ä¸¥æ ¼æ¨¡å¼æµ‹è¯•":
                model.EscToClose = false;
                model.MaskToClose = false;
                break;
        }
    }

    // ========== åŸºç¡€å¯¹è¯æ¡†æµ‹è¯• ==========
    private async Task TestAlert()
    {
        await DialogService.AlertAsync("è¿™æ˜¯ä¸€ä¸ª Alert æç¤ºæ¡†æµ‹è¯•ã€‚\nç‚¹å‡»ç¡®å®šå…³é—­ã€‚", "æµ‹è¯• Alert");
        _lastResult = "Alert å·²å…³é—­";
    }

    private async Task TestConfirm()
    {
        var result = await DialogService.ConfirmAsync("ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ\nè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ“ä½œã€‚", "ç¡®è®¤æ“ä½œ");
        _lastResult = $"Confirm ç»“æœ: {(result ? "ç¡®å®š" : "å–æ¶ˆ")}";
        
        if (result)
        {
            DialogService.Toast("æ‚¨ç‚¹å‡»äº†ç¡®å®š", ToastType.Success);
        }
        else
        {
            DialogService.Toast("æ‚¨ç‚¹å‡»äº†å–æ¶ˆ", ToastType.Info);
        }
    }

    private async Task TestPrompt()
    {
        var result = await DialogService.PromptAsync("è¯·è¾“å…¥æ‚¨çš„åå­—ï¼š", "è¾“å…¥æµ‹è¯•");
        if (result == null)
        {
            _lastResult = "Prompt å·²å–æ¶ˆ";
            DialogService.Toast("å–æ¶ˆè¾“å…¥", ToastType.Warning);
        }
        else
        {
            _lastResult = $"Prompt ç»“æœ: {result}";
            DialogService.Toast($"æ‚¨è¾“å…¥äº†: {result}", ToastType.Success);
        }
    }

    private async Task TestPromptWithDefault()
    {
        var result = await DialogService.PromptAsync("è¯·è¾“å…¥é‚®ç®±åœ°å€ï¼š", "è¾“å…¥æµ‹è¯•", "user@example.com");
        if (result != null)
        {
            _lastResult = $"è¾“å…¥çš„é‚®ç®±: {result}";
            DialogService.Toast($"é‚®ç®±: {result}", ToastType.Success);
        }
        else
        {
            _lastResult = "å–æ¶ˆè¾“å…¥";
        }
    }

    // ========== è‡ªå®šä¹‰ç»„ä»¶å¯¹è¯æ¡† ==========
    private async Task TestCustomComponent()
    {
        await DialogService.ShowComponentAsync(
            "ç®€å•è¡¨å•",
            @<div style="padding: 20px;">
                <p style="margin-bottom: 15px;">è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶å¯¹è¯æ¡†ç¤ºä¾‹ã€‚</p>
                <div style="margin-bottom: 10px;">
                    <label>å§“å:</label>
                    <input type="text" style="width: 100%; padding: 5px; margin-top: 5px;" />
                </div>
                <div>
                    <label>å¤‡æ³¨:</label>
                    <textarea style="width: 100%; padding: 5px; margin-top: 5px; min-height: 60px;"></textarea>
                </div>
            </div>
        );
        _lastResult = "è‡ªå®šä¹‰ç»„ä»¶å¯¹è¯æ¡†å·²å…³é—­";
    }

    private async Task TestCustomComponentWithResult()
    {
        var userName = "";
        var userEmail = "";

        var result = await DialogService.ShowComponentAsync<bool>(
            "ç”¨æˆ·ä¿¡æ¯",
            @<div style="padding: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">å§“å:</label>
                    <input type="text" @bind="userName" style="width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px;" />
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">é‚®ç®±:</label>
                    <input type="email" @bind="userEmail" style="width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px;" />
                </div>
                <p style="color: var(--color-text-muted); font-size: 0.9em;">ç‚¹å‡»ç¡®å®šæŒ‰é’®å°†è¿”å› true</p>
            </div>,
            "500px"
        );

        if (result == true)
        {
            _componentResult = $"å§“å: {userName}\né‚®ç®±: {userEmail}\nè¿”å›å€¼: true";
            DialogService.Toast("è¡¨å•å·²æäº¤", ToastType.Success);
        }
        else
        {
            _componentResult = "ç”¨æˆ·å–æ¶ˆäº†æ“ä½œ";
        }
    }

    private async Task TestComplexForm()
    {
        var formData = new FormData();

        await DialogService.ShowComponentAsync(
            "å¤æ‚è¡¨å•ç¤ºä¾‹",
            @<div style="padding: 20px;">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">ç”¨æˆ·å:</label>
                    <input type="text" @bind="formData.Username" style="width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px;" />
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">ç±»å‹:</label>
                    <select @bind="formData.UserType" style="width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px;">
                        <option value="æ™®é€šç”¨æˆ·">æ™®é€šç”¨æˆ·</option>
                        <option value="VIPç”¨æˆ·">VIPç”¨æˆ·</option>
                        <option value="ç®¡ç†å‘˜">ç®¡ç†å‘˜</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" @bind="formData.AcceptTerms" style="margin-right: 8px;" />
                        åŒæ„æœåŠ¡æ¡æ¬¾
                    </label>
                </div>
                <div style="background: var(--color-bg-surface-alt); padding: 10px; border-radius: 4px;">
                    <strong>å½“å‰é€‰æ‹©:</strong>
                    <p>ç”¨æˆ·å: @formData.Username</p>
                    <p>ç±»å‹: @formData.UserType</p>
                    <p>åŒæ„æ¡æ¬¾: @(formData.AcceptTerms ? "æ˜¯" : "å¦")</p>
                </div>
            </div>,
            "600px"
        );

        _componentResult = $"ç”¨æˆ·å: {formData.Username}\nç±»å‹: {formData.UserType}\nåŒæ„æ¡æ¬¾: {formData.AcceptTerms}";
    }

    private async Task TestCustomWidth()
    {
        await DialogService.ShowComponentAsync(
            "è‡ªå®šä¹‰å®½åº¦ (800px)",
            @<div style="padding: 20px; text-align: center;">
                <h3 style="margin-bottom: 20px;">è¿™æ˜¯ä¸€ä¸ª 800px å®½çš„å¯¹è¯æ¡†</h3>
                <p>æ‚¨å¯ä»¥åœ¨ ShowComponentAsync æ–¹æ³•ä¸­æŒ‡å®šå¯¹è¯æ¡†å®½åº¦ã€‚</p>
                <div style="margin-top: 30px; padding: 20px; background: var(--color-bg-surface-alt); border-radius: 8px;">
                    <p>è¿™é‡Œå¯ä»¥æ”¾ç½®æ›´å¤šå†…å®¹...</p>
                    <p>æ¯”å¦‚è¡¨æ ¼ã€å›¾è¡¨ã€å¤æ‚è¡¨å•ç­‰ã€‚</p>
                </div>
            </div>,
            "800px"
        );
    }

    // ========== Toast æµ‹è¯• ==========
    private void MultipleToasts()
    {
        DialogService.Toast("Info æ¶ˆæ¯", ToastType.Info);
        DialogService.Toast("Success æ¶ˆæ¯", ToastType.Success);
        DialogService.Toast("Warning æ¶ˆæ¯", ToastType.Warning);
        DialogService.Toast("Error æ¶ˆæ¯", ToastType.Error);
    }

    private void TestToastDuration()
    {
        DialogService.Toast("è¿™æ¡æ¶ˆæ¯ä¼šæ˜¾ç¤º 1 ç§’", ToastType.Info, 1000);
        DialogService.Toast("è¿™æ¡æ¶ˆæ¯ä¼šæ˜¾ç¤º 5 ç§’", ToastType.Success, 5000);
        DialogService.Toast("è¿™æ¡æ¶ˆæ¯ä¼šæ˜¾ç¤º 10 ç§’", ToastType.Warning, 10000);
    }

    // ========== Notification æµ‹è¯• ==========
    private void TestBasicNotification()
    {
        DialogService.ShowNotification(
            "è¿™æ˜¯ä¸€æ¡åŸºç¡€é€šçŸ¥æ¶ˆæ¯ï¼Œ3ç§’åè‡ªåŠ¨å…³é—­ã€‚",
            "åŸºç¡€é€šçŸ¥",
            NotificationType.Info,
            3000
        );
    }

    private void TestPersistentNotification()
    {
        DialogService.ShowNotification(
            "è¿™æ˜¯ä¸€æ¡æŒä¹…é€šçŸ¥ï¼Œä¸ä¼šè‡ªåŠ¨å…³é—­ã€‚éœ€è¦æ‰‹åŠ¨ç‚¹å‡»å…³é—­æŒ‰é’®ã€‚",
            "æŒä¹…é€šçŸ¥",
            NotificationType.Warning,
            0
        );
    }

    private async Task TestProgressNotification()
    {
        var notification = DialogService.ShowNotification(
            new NotificationOptions
            {
                Title = "æ–‡ä»¶ä¸Šä¼ ",
                Content = "å‡†å¤‡ä¸Šä¼ ...",
                Type = NotificationType.Info,
                Bars = [0],
                AutoClose = 0
            }
        );

        await Task.Delay(500);
        notification.UpdateContent?.Invoke("æ­£åœ¨ä¸Šä¼ ...");

        for (int i = 0; i <= 100; i += 5)
        {
            await Task.Delay(100);
            notification.UpdateProgress?.Invoke([i]);
            notification.UpdateContent?.Invoke($"ä¸Šä¼ è¿›åº¦: {i}%");
        }

        notification.UpdateTitle?.Invoke("ä¸Šä¼ å®Œæˆ");
        notification.UpdateContent?.Invoke("æ–‡ä»¶å·²æˆåŠŸä¸Šä¼ ï¼");
        notification.UpdateType?.Invoke(NotificationType.Success);

        await Task.Delay(2000);
        notification.Close?.Invoke();
    }

    private async Task TestMultiProgressNotification()
    {
        var notification = DialogService.ShowNotification(
            new NotificationOptions
            {
                Title = "æ‰¹é‡å¤„ç†",
                Content = "åˆå§‹åŒ–ä»»åŠ¡...",
                Type = NotificationType.Info,
                Bars = [0, 0, 0],
                AutoClose = 0
            }
        );

        double[] progress = [0, 0, 0];

        for (int i = 0; i <= 100; i += 2)
        {
            await Task.Delay(50);
            progress[0] = Math.Min(100, i * 1.2);
            progress[1] = Math.Min(100, i * 0.8);
            progress[2] = Math.Min(100, i * 1.5);

            notification.UpdateProgress?.Invoke(progress);
            notification.UpdateContent?.Invoke($"ä»»åŠ¡A: {progress[0]:F0}% | ä»»åŠ¡B: {progress[1]:F0}% | ä»»åŠ¡C: {progress[2]:F0}%");
        }

        notification.UpdateTitle?.Invoke("å…¨éƒ¨å®Œæˆ");
        notification.UpdateContent?.Invoke("æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼");
        notification.UpdateType?.Invoke(NotificationType.Success);

        await Task.Delay(3000);
        notification.Close?.Invoke();
    }

    private void TestRichNotification()
    {
        var html = @"
            <div style='line-height: 1.6;'>
                <p><strong>å¯Œæ–‡æœ¬é€šçŸ¥ç¤ºä¾‹</strong></p>
                <p style='color: var(--color-text-secondary);'>æ”¯æŒ HTML æ ¼å¼çš„å†…å®¹ï¼š</p>
                <ul style='margin-left: 20px; list-style-type: disc;'>
                    <li><span style='color: #ef4444;'>çº¢è‰²æ–‡å­—</span></li>
                    <li><span style='color: #10b981;'>ç»¿è‰²æ–‡å­—</span></li>
                    <li><span style='color: #3b82f6;'>è“è‰²æ–‡å­—</span></li>
                </ul>
                <p style='margin-top: 10px;'>
                    <code style='background: rgba(0,0,0,0.1); padding: 2px 6px; border-radius: 3px;'>ä»£ç å—</code>
                </p>
            </div>
        ";
        
        DialogService.ShowNotification(html, "å¯Œæ–‡æœ¬é€šçŸ¥", NotificationType.Info, 0);
    }

    // ========== å®é™…åœºæ™¯æ¨¡æ‹Ÿ ==========
    private async Task DeleteWorkflow()
    {
        var confirmed = await DialogService.ConfirmAsync(
            "æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œç¡®å®šè¦åˆ é™¤è¯¥å·¥ä½œæµå—ï¼Ÿ\næ‰€æœ‰ç›¸å…³æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚",
            "åˆ é™¤ç¡®è®¤"
        );
        
        if (!confirmed)
        {
            _lastResult = "å–æ¶ˆåˆ é™¤";
            return;
        }

        var input = await DialogService.PromptAsync(
            "è¯·è¾“å…¥ 'DELETE' ä»¥ç¡®è®¤åˆ é™¤ï¼š",
            "å®‰å…¨ç¡®è®¤"
        );
        
        if (input == "DELETE")
        {
            var notification = DialogService.ShowNotification("æ­£åœ¨åˆ é™¤...", "åˆ é™¤å·¥ä½œæµ", NotificationType.Warning);
            await Task.Delay(1500);
            notification.Close?.Invoke();
            
            DialogService.Toast("åˆ é™¤æˆåŠŸ", ToastType.Success);
            _lastResult = "åˆ é™¤æˆåŠŸ";
        }
        else if (input != null)
        {
            DialogService.Toast("è¾“å…¥é”™è¯¯ï¼Œå–æ¶ˆåˆ é™¤", ToastType.Error);
            _lastResult = "åˆ é™¤å¤±è´¥ (è¾“å…¥é”™è¯¯)";
        }
        else
        {
            _lastResult = "åˆ é™¤å·²å–æ¶ˆ";
        }
    }

    private async Task ComplexProcess()
    {
        await DialogService.AlertAsync("ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ®\n\næ­£åœ¨æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒ...", "æµç¨‹å¼€å§‹");
        
        var proceed = await DialogService.ConfirmAsync(
            "æ•°æ®å‡†å¤‡å°±ç»ªï¼Œç³»ç»Ÿæ£€æŸ¥å®Œæˆã€‚\n\næ˜¯å¦ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Ÿ",
            "ç¡®è®¤ç»§ç»­"
        );
        
        if (!proceed)
        {
            DialogService.Toast("æµç¨‹å·²ç»ˆæ­¢", ToastType.Warning);
            _lastResult = "æµç¨‹å·²ç»ˆæ­¢";
            return;
        }

        var notification = DialogService.ShowNotification("å¤„ç†ä¸­...", "æ‰§è¡Œæµç¨‹", NotificationType.Info);
        await Task.Delay(2000);
        notification.Close?.Invoke();
        
        await DialogService.AlertAsync(
            "å¤„ç†å®Œæˆï¼\n\nç»“æœå·²ç”Ÿæˆå¹¶ä¿å­˜åˆ°ç³»ç»Ÿã€‚",
            "æ‰§è¡ŒæˆåŠŸ"
        );
        
        _lastResult = "æµç¨‹æ‰§è¡ŒæˆåŠŸ";
    }

    private async Task SimulateDownload()
    {
        var notification = DialogService.ShowNotification(
            new NotificationOptions
            {
                Title = "æ–‡ä»¶ä¸‹è½½",
                Content = "æ­£åœ¨è¿æ¥æœåŠ¡å™¨...",
                Type = NotificationType.Info,
                Bars = [0],
                AutoClose = 0
            }
        );
        
        await Task.Delay(1000);
        notification.UpdateContent?.Invoke("å¼€å§‹ä¸‹è½½...");

        for (int i = 0; i <= 100; i += 10)
        {
            await Task.Delay(300);
            notification.UpdateProgress?.Invoke([i]);
            notification.UpdateContent?.Invoke($"ä¸‹è½½ä¸­... {i}%\næ–‡ä»¶å¤§å°: 25.6 MB");
        }

        notification.UpdateTitle?.Invoke("ä¸‹è½½å®Œæˆ");
        notification.UpdateContent?.Invoke("æ–‡ä»¶å·²ä¿å­˜åˆ°æœ¬åœ°ã€‚\nä½ç½®: C:\\Downloads\\file.zip");
        notification.UpdateType?.Invoke(NotificationType.Success);
        
        await Task.Delay(3000);
        notification.Close?.Invoke();
        
        _lastResult = "ä¸‹è½½å®Œæˆ";
    }

    private async Task SimulateMultiTask()
    {
        var notification = DialogService.ShowNotification(
            new NotificationOptions
            {
                Title = "æ‰¹å¤„ç†ä»»åŠ¡",
                Content = "æ­£åœ¨å¤„ç†å¤šä¸ªä»»åŠ¡...",
                Type = NotificationType.Warning,
                Bars = [0, 0],
                AutoClose = 0
            }
        );
        
        double[] progress = [0, 0];
        
        for (int i = 0; i <= 20; i++)
        {
            await Task.Delay(200);
            progress[0] = Math.Min(100, i * 5);
            progress[1] = Math.Min(100, i * 3);
            
            notification.UpdateProgress?.Invoke(progress);
            notification.UpdateContent?.Invoke($"ä»»åŠ¡A: {progress[0]:F0}% | ä»»åŠ¡B: {progress[1]:F0}%");
        }
        
        for (int i = 0; i <= 15; i++)
        {
            await Task.Delay(100);
            progress[1] = Math.Min(100, 60 + i * 3);
            notification.UpdateProgress?.Invoke(progress);
            notification.UpdateContent?.Invoke($"ä»»åŠ¡A: å®Œæˆ | ä»»åŠ¡B: {progress[1]:F0}%");
        }

        notification.UpdateContent?.Invoke("æ‰€æœ‰ä»»åŠ¡å¤„ç†å®Œæ¯•ï¼");
        notification.UpdateType?.Invoke(NotificationType.Success);
        
        await Task.Delay(2000);
        notification.Close?.Invoke();
        
        _lastResult = "æ‰¹å¤„ç†å®Œæˆ";
    }

    private async Task UserRegistration()
    {
        var username = await DialogService.PromptAsync("è¯·è¾“å…¥ç”¨æˆ·åï¼š", "ç”¨æˆ·æ³¨å†Œ", "");
        if (string.IsNullOrWhiteSpace(username))
        {
            DialogService.Toast("ç”¨æˆ·åä¸èƒ½ä¸ºç©º", ToastType.Error);
            return;
        }

        var email = await DialogService.PromptAsync("è¯·è¾“å…¥é‚®ç®±ï¼š", "ç”¨æˆ·æ³¨å†Œ", "");
        if (string.IsNullOrWhiteSpace(email) || !email.Contains("@"))
        {
            DialogService.Toast("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®", ToastType.Error);
            return;
        }

        var confirmed = await DialogService.ConfirmAsync(
            $"ç”¨æˆ·å: {username}\né‚®ç®±: {email}\n\nç¡®è®¤æ³¨å†Œï¼Ÿ",
            "ç¡®è®¤ä¿¡æ¯"
        );

        if (confirmed)
        {
            var notification = DialogService.ShowNotification("æ­£åœ¨åˆ›å»ºè´¦æˆ·...", "æ³¨å†Œä¸­", NotificationType.Info);
            await Task.Delay(2000);
            notification.Close?.Invoke();

            await DialogService.AlertAsync("æ³¨å†ŒæˆåŠŸï¼\n\næ¿€æ´»é‚®ä»¶å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ã€‚", "æ³¨å†ŒæˆåŠŸ");
            _lastResult = $"æ³¨å†ŒæˆåŠŸ: {username}";
        }
    }

    // ========== è¾¹ç•Œæµ‹è¯• ==========
    private async Task TestLongMessage()
    {
        var longMessage = @"è¿™æ˜¯ä¸€æ¡éå¸¸é•¿çš„æ¶ˆæ¯å†…å®¹ï¼Œç”¨äºæµ‹è¯•å¯¹è¯æ¡†åœ¨å¤„ç†é•¿æ–‡æœ¬æ—¶çš„è¡¨ç°ã€‚

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

æµ‹è¯•å†…å®¹åŒ…æ‹¬ï¼š
1. å¤šè¡Œæ–‡æœ¬æ˜¾ç¤º
2. ä¸­è‹±æ–‡æ··åˆ
3. ç‰¹æ®Šç¬¦å· @#$%^&*()
4. æ¢è¡Œå¤„ç†

è¿™æ®µæ–‡æœ¬åº”è¯¥èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºå¹¶æ”¯æŒæ»šåŠ¨ã€‚";

        await DialogService.AlertAsync(longMessage, "è¶…é•¿æ¶ˆæ¯æµ‹è¯•");
        _lastResult = "é•¿æ¶ˆæ¯æµ‹è¯•å®Œæˆ";
    }

    private async Task TestEmptyInput()
    {
        var result = await DialogService.PromptAsync("å°è¯•ç›´æ¥ç‚¹å‡»ç¡®å®šï¼ˆä¸è¾“å…¥ä»»ä½•å†…å®¹ï¼‰ï¼š", "ç©ºè¾“å…¥æµ‹è¯•", "");
        if (string.IsNullOrEmpty(result))
        {
            DialogService.Toast("æ£€æµ‹åˆ°ç©ºè¾“å…¥", ToastType.Warning);
            _lastResult = "è¾“å…¥ä¸ºç©º";
        }
        else if (result == null)
        {
            _lastResult = "å–æ¶ˆè¾“å…¥";
        }
        else
        {
            _lastResult = $"è¾“å…¥äº†: '{result}'";
        }
    }

    private async Task TestNestedDialogs()
    {
        await DialogService.AlertAsync("è¿™æ˜¯ç¬¬ä¸€å±‚å¯¹è¯æ¡†", "åµŒå¥—æµ‹è¯• - å±‚çº§ 1");
        
        var result = await DialogService.ConfirmAsync("è¿™æ˜¯ç¬¬äºŒå±‚å¯¹è¯æ¡†\næ˜¯å¦ç»§ç»­æ‰“å¼€ç¬¬ä¸‰å±‚ï¼Ÿ", "åµŒå¥—æµ‹è¯• - å±‚çº§ 2");
        
        if (result)
        {
            var input = await DialogService.PromptAsync("è¿™æ˜¯ç¬¬ä¸‰å±‚å¯¹è¯æ¡†\nè¯·è¾“å…¥ä»»æ„å†…å®¹ï¼š", "åµŒå¥—æµ‹è¯• - å±‚çº§ 3", "æµ‹è¯•");
            _lastResult = $"åµŒå¥—æµ‹è¯•å®Œæˆï¼Œè¾“å…¥: {input}";
            DialogService.Toast("åµŒå¥—å¯¹è¯æ¡†æµ‹è¯•å®Œæˆ", ToastType.Success);
        }
    }

    private async Task TestRapidFire()
    {
        DialogService.Toast("ç¬¬1æ¡æ¶ˆæ¯", ToastType.Info);
        await Task.Delay(100);
        DialogService.Toast("ç¬¬2æ¡æ¶ˆæ¯", ToastType.Success);
        await Task.Delay(100);
        DialogService.Toast("ç¬¬3æ¡æ¶ˆæ¯", ToastType.Warning);
        await Task.Delay(100);
        DialogService.Toast("ç¬¬4æ¡æ¶ˆæ¯", ToastType.Error);
        await Task.Delay(100);
        DialogService.Toast("ç¬¬5æ¡æ¶ˆæ¯", ToastType.Info);
        
        _lastResult = "å¿«é€Ÿè§¦å‘5æ¡æ¶ˆæ¯";
    }

    private async Task TestSpecialCharacters()
    {
        var message = @"ç‰¹æ®Šå­—ç¬¦æµ‹è¯•ï¼š
< > & "" '
\n \t \r
ğŸ˜€ ğŸ˜ƒ ğŸ˜„ ğŸ˜ ğŸ‰
HTML: <script>alert('test')</script>
SQL: '; DROP TABLE users; --
è·¯å¾„: C:\Windows\System32\test.txt";

        await DialogService.AlertAsync(message, "ç‰¹æ®Šå­—ç¬¦æµ‹è¯•");
        _lastResult = "ç‰¹æ®Šå­—ç¬¦æµ‹è¯•å®Œæˆ";
    }

    // ========== é«˜çº§äº¤äº’æµ‹è¯• ==========
    private async Task TestMaskToClose()
    {
        await DialogService.AlertAsync(
            "è¯·å°è¯•ç‚¹å‡»é®ç½©å±‚ï¼ˆç°è‰²èƒŒæ™¯ï¼‰æ¥å…³é—­æ­¤å¯¹è¯æ¡†ã€‚\nMaskToClose = true",
            "ç‚¹å‡»é®ç½©å…³é—­æµ‹è¯•"
        );
        _lastResult = "å¯¹è¯æ¡†å·²å…³é—­";
    }

    private async Task TestNoEsc()
    {
        await DialogService.AlertAsync(
            "è¯·å°è¯•æŒ‰ Esc é”®ï¼ˆåº”è¯¥æ— æ•ˆï¼‰ã€‚\nåªèƒ½ç‚¹å‡»ç¡®å®šæŒ‰é’®å…³é—­ã€‚\nEscToClose = false",
            "ç¦ç”¨ Esc æµ‹è¯•"
        );
        _lastResult = "å¯¹è¯æ¡†å·²å…³é—­";
    }

    private async Task TestStrictDialog()
    {
        var result = await DialogService.ConfirmAsync(
            "æ­¤å¯¹è¯æ¡†ç¦ç”¨äº† Esc å’Œé®ç½©å±‚å…³é—­ã€‚\nå¼ºåˆ¶ç”¨æˆ·å¿…é¡»è¿›è¡Œæ˜¾å¼æ“ä½œã€‚\nEscToClose = false\nMaskToClose = false",
            "ä¸¥æ ¼æ¨¡å¼æµ‹è¯•"
        );
        _lastResult = $"ä¸¥æ ¼æ¨¡å¼å¯¹è¯æ¡†ç»“æœ: {(result ? "ç¡®å®š" : "å–æ¶ˆ")}";
    }

    // è¾…åŠ©ç±»
    private class FormData
    {
        public string Username { get; set; } = "";
        public string UserType { get; set; } = "æ™®é€šç”¨æˆ·";
        public bool AcceptTerms { get; set; } = false;
    }
}
